<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YelpCamp</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" 
  integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" 
  crossorigin="anonymous">

  <!-- MapTiler SDK CSS -->
  <link href="https://cdn.maptiler.com/maptiler-sdk-js/v1.1.1/maptiler-sdk.css" rel="stylesheet" 
  crossorigin="anonymous"/>

  <!-- MapTiler SDK JS -->
  <script src="https://cdn.maptiler.com/maptiler-sdk-js/v1.1.1/maptiler-sdk.umd.min.js"
  crossorigin="anonymous"></script>

  <!-- Optional additional CSS -->
  <link rel="stylesheet" href="/stylesheets/stars.css"
  crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/app.css"
  crossorigin="anonymous">
</head>

<body class="d-flex flex-column vh-100">

  <!-- Navbar -->
  <%- include('../partials/navbar') %>

  <main class="container mt-5">
    <!-- Flash messages -->
    <%- include('../partials/flash') %>

    <!-- Page content -->
    <%- body %>
  </main>

  <!-- Footer -->
  <%- include('../partials/footer') %>

  <!-- Bootstrap JS + Popper -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" 
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" 
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" 
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" 
    crossorigin="anonymous"></script>

  <!-- Safe DOM scripts -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // File input handler
      const fileInput = document.getElementById('image');
      const fileChosen = document.getElementById('file-chosen');

      if (fileInput && fileChosen) {
        fileInput.addEventListener('change', () => {
          if (fileInput.files.length > 0) {
            const names = [...fileInput.files].map(f => f.name).join(', ');
            fileChosen.textContent = names;
          } else {
            fileChosen.textContent = "No files chosen";
          }
        });
      }

      // Initialize Map if map container exists
      const mapElement = document.getElementById('map');
      const campgroundDataScript = document.getElementById('campground-data');

      if (mapElement && campgroundDataScript && typeof maptilersdk !== 'undefined') {
        const campground = JSON.parse(campgroundDataScript.textContent);
        maptilersdk.config.apiKey = '<%- process.env.MAPTILER_API_KEY %>';

        // Make sure coordinates exist and are valid
        if (campground.coordinates && Array.isArray(campground.coordinates) && campground.coordinates.length === 2) {
          const map = new maptilersdk.Map({
            container: 'map',
            style: maptilersdk.MapStyle.BRIGHT,
            center: [campground.coordinates[0], campground.coordinates[1]], // [lng, lat]
            zoom: 10
          });

          new maptilersdk.Marker()
            .setLngLat([campground.coordinates[0], campground.coordinates[1]])
            .setPopup(
              new maptilersdk.Popup({ offset: 25 })
                .setHTML(`<h3>${campground.title}</h3><p>${campground.location}</p>`)
            )
            .addTo(map);
        }
      }
    });
  </script>

  <!-- Validate Forms JS -->
  <script src="/javascripts/validateForms.js"></script>

</body>
</html>
